import { PackageURL } from 'packageurl-js';
import { IVulnFetcher } from './IVulnFetcher';
import { request } from '../pages/api/vuln';

export class SonatypeOSSVulnFetcher implements IVulnFetcher {
  name = 'SonatypeOSS';
  url = 'https://ossindex.sonatype.org/api/v3/component-report';

  fetchInfo = async (purl: string) => {
    const options: RequestInit = {
      method: 'POST',
      headers: {
        accept: 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ coordinates: [purl] }),
    };
    const res = await request(this.url, options);
    console.log(res);
    if (res) {
      return res[0].vulnerabilities || [];
    }
  };
}
